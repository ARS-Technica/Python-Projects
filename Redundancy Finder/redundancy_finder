"""
Load the two words in the redundant phrase from an external file,
rather than calling the phrase as part of the function call.

Iterate through every pair in redundant_phrases.txt
"""


import re
# Import tkinter library
from tkinter import filedialog
from tkinter import *

class FuzzySearch:
    def word_search(self):
        win = Tk()
        # win.geometry("750x450")
        
        text = Text(win)
        text.pack()

        # How close do words need to be inside a sentence to be detected.
        proximity = 5

        # Define the color codes for highlighting the text in a textfield
        text.tag_config('redundant', background='red')    # Red background

        # Reset color to default
        # t.tag_delete('failed')     

        # Use the filedialog module to allow the user to select the file to search
        filename = filedialog.askopenfilename()

        # Load a file of phrases to search the text file for
        # This will be pre-selected, rather than user-selected
        with open('redundant_phrases.txt', 'r') as pairs_file:
            # Break pairs into individual words, stripped of spaces
            redundancies = [line.replace(" ", "").strip().split(',') for line in pairs_file]

        # print(redundancies)


        # Line counter for use in the highlighting
        line_count = 0


        # Open the file to be searched
        with open(filename, 'r') as file:

            # Read the file line by line
            for line in file:
                line_count += 1
                text.insert(END, line)
                
            # Iterate through every possible redundancy in redundant_phrases.txt
            for phrase1, phrase2 in redundancies: 
                # Check if both words are in the line within the specified proximity
                if phrase1 and phrase2 in line:
                    words = re.findall(r"[\w']+|[.,!?;]", line)
                    # Unicode version: re.findall(r"\w+|[^\w\s]", text, re.UNICODE)

                    if abs(words.index(phrase1) - words.index(phrase2)) <= proximity:
                        # If the words are found within proximity, highlight them in the line and print the result                       
                        idx1 = '{}.{}'.format(line_count, line.index(phrase1))
                        pos1 = '{}.{}'.format(line_count, line.index(phrase1) + len(phrase1)) 
                        idx2 = '{}.{}'.format(line_count, line.index(phrase2))
                        pos2 = '{}.{}'.format(line_count, line.index(phrase2) + len(phrase2))

                        text.tag_add('redundant', idx1, pos1)
                        text.tag_add('redundant', idx2, pos2)

            win.mainloop()


if __name__ == '__main__':
    FuzzySearch().word_search()

