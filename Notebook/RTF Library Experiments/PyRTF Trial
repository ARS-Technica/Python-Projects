"""
Note: Python libraries for handling Rich Text files
are neither well maintained nor well documented.
The only library that works well with Python 3+ is 
pyrtf 0.45:

https://anaconda.org/conda-forge/pyrtf
conda install conda-forge::pyrtf
"""


from tkinter import *
from tkinter import filedialog
from win32com.client import Dispatch
from docx import Document
from reportlab.pdfgen import canvas

def open_file():
    file_path = filedialog.askopenfilename(
        filetypes=[("Text files", "*.txt"), ("Rich Text Format files", "*.rtf")]
    )
    if file_path:
        if file_path.endswith(".rtf"):
            # Convert RTF to DOCX using Word
            word = Dispatch("Word.Application")
            doc = word.Documents.Open(file_path)
            docx_path = file_path.replace(".rtf", ".docx")
            doc.SaveAs(docx_path, FileFormat=16)  # 16 for DOCX format
            doc.Close()
            word.Quit()
            file_path = docx_path  # Use the converted DOCX file

        # Read DOCX content using docx library
        document = Document(file_path)
        text_content = "\n".join([paragraph.text for paragraph in document.paragraphs])
        text.delete(1.0, END)  # Clear the text widget
        text.insert(END, text_content)  # Insert the DOCX text

        # Optionally apply basic formatting
        # text.tag_add("bold", "1.0", "1.4")  # Example: Make first 4 characters bold
        # text.tag_config("bold", font=("Helvetica", 14, "bold"))

def save_file():
    file_path = filedialog.asksaveasfilename(defaultextension=".txt", filetypes=[("Text files", "*.txt"), ("Rich Text Format files", "*.rtf"), ("PDF files", "*.pdf")])
    if file_path:
        content = text.get(1.0, END)
        if file_path.endswith(".txt"):
            # Save as .txt
            with open(file_path, 'w', encoding='utf-8') as file:
                file.write(content)
        elif file_path.endswith(".rtf"):
            # Save as .rtf using pythondocx
            doc = RTFReader.read(content)
            with open(file_path, 'w', encoding='utf-8') as file:
                file.write(RTFWriter.write(doc).getvalue())
        elif file_path.endswith(".pdf"):
            # Save as .pdf using ReportLab
            pdf_canvas = canvas.Canvas(file_path)
            pdf_canvas.drawString(100, 800, content)
            pdf_canvas.save()

# Create the main window
root = Tk()
root.title("Text Editor")

# Create a Text widget
text = Text(root, wrap="word")
text.pack(expand=YES, fill=BOTH)

# Create a Menu
menubar = Menu(root)
root.config(menu=menubar)

# File menu
file_menu = Menu(menubar, tearoff=0)
menubar.add_cascade(label="File", menu=file_menu)

# File menu items
file_menu.add_command(label="Open", command=open_file)
file_menu.add_command(label="Save", command=save_file)
file_menu.add_separator()
file_menu.add_command(label="Exit", command=root.destroy)

# Start the main event loop
root.mainloop()



