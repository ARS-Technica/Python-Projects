"""
A simple .rtf file reader written with assistance 
from the Pyth library after repeatedly failing to make
PyRTF parse .rtf files in Python 3.
"""

from tkinter import *
from tkinter import filedialog
from PyRTF import *
from pyth.plugins.plaintext.writer import PlaintextWriter
from pyth.plugins.html.writer import HTMLWriter
from pyth import Document

def create_rtf_file():
    doc = MakeExample()
    DR = Renderer()
    DR.Write(doc, OpenFile('rtfteste.rtf'))
    print("RTF file created")

def open_rtf_file():
    file_path = filedialog.askopenfilename(filetypes=[("Rich Text Format files", "*.rtf")])
    if file_path:
        with open(file_path, 'r', encoding='utf-8') as file:
            rtf_content = file.read()

        # Convert RTF to HTML
        doc = Document.from_rtf_string(rtf_content)
        html_content = HTMLWriter.write(doc).getvalue()

        # Insert HTML content into the Tkinter Text widget
        text.delete(1.0, END)
        text.insert(END, html_content)
        print("RTF file opened and converted to HTML")

def save_rtf_file():
    file_path = filedialog.asksaveasfilename(defaultextension=".rtf", filetypes=[("Rich Text Format files", "*.rtf")])
    if file_path:
        html_content = text.get(1.0, END)

        # Convert HTML to RTF
        doc = Document.from_html_string(html_content)
        rtf_content = PlaintextWriter.write(doc).getvalue()

        # Save as RTF
        with open(file_path, 'w', encoding='utf-8') as file:
            file.write(rtf_content)
        print("HTML content saved as RTF")

# Create the main window
root = Tk()
root.title("RTF to HTML Converter")

# Create a Text widget
text = Text(root, wrap="word")
text.pack(expand=YES, fill=BOTH)

# Create a Menu
menubar = Menu(root)
root.config(menu=menubar)

# File menu
file_menu = Menu(menubar, tearoff=0)
menubar.add_cascade(label="File", menu=file_menu)

# File menu items
file_menu.add_command(label="Create RTF", command=create_rtf_file)
file_menu.add_command(label="Open RTF", command=open_rtf_file)
file_menu.add_command(label="Save RTF", command=save_rtf_file)
file_menu.add_separator()
file_menu.add_command(label="Exit", command=root.destroy)

# Start the main event loop
root.mainloop()

